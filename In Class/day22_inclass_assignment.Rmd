---
title: "Day 22: Assignment"
author: "Natalie Sawtelle"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(ggfortify)
library(GGally)
library(car)
library(StepReg)
```

## Data

Quoted from the *Framingham Heart Study* website at `framinghamheartstudy.org`:

Cardiovascular disease (CVD) is the leading cause of death and serious illness in the United States. In 1948, the Framingham Heart Study - under the direction of the National Heart Institute (now known as the National Heart, Lung, and Blood Institute or NHLBI) - embarked on an ambitious project in health research. At the time, little was known about the general causes of heart disease and stroke, but the death rates for CVD had been increasing steadily since the beginning of the century and had become an American epidemic. The Framingham Heart Study became a joint project of the National Heart, Lung and Blood Institute and Boston University.

The objective of the Framingham Heart Study was to identify the common factors or characteristics that contribute to CVD by following its development over a long period of time in a large group of participants who had not yet developed overt symptoms of CVD or suffered a heart attack or stroke. The researchers recruited 5,209 men and women between the ages of 30 and 62 from the town of Framingham, Massachusetts, and began the first round of extensive physical examinations and lifestyle interviews that they would later analyze for common patterns related to CVD development. Since 1948, the subjects have continued to return to the study every two years for a detailed medical history, physical examination, and laboratory tests, and in 1971, the Study enrolled a second generation - 5,124 of the original participantsâ€™ adult children and their spouses - to participate in similar examinations. The study continues with new cohorts to this day.

The datafile `framingham.txt` contains selected variables for 4,658 participants in the study. The variables are:

* `age` - subject age in years
* `sbp` - systolic blood pressure
* `dbp` - diastolic blood pressure
* `scl` - serum cholesterol level
* `bmi` - BMI (Body Mass Index)
* `chdfate` - Indicator of whether the subject has been diagnosed (1) or not (0) with coronary heart disease


## Supplied Code

```{r}
framingham <- read_table("framingham.txt", show_col_types=FALSE)
```


----

## QUESTION 1

Fit a full main effects logistic regression to model whether a patient has coronary heart disease as a function of age, systolic blood pressure, diastolic blood pressure, serum cholesterol level and BMI.


```{r}
full_fit <- glm(chdfate ~ age + sbp + dbp + scl + bmi,
                     data=framingham,
                     family=binomial(link="logit"))

summary(full_fit)
```



## QUESTION 2

Does the model fit in Question 1 significantly predict the probability a patient has coronary heart disease?


```{r, message=FALSE}
null_fit <- glm(chdfate ~ 1, data = framingham, family = binomial(link="logit"))

anova(null_fit, full_fit)
```

**Yes the full fit model does significantly predict the probability a patient has coronary heart disease. The p-value of 2.2e-16 is significantly less than 0.05.**





## QUESTION 3

Approximately what percentage of the deviance in the probability of patients with coronary heart disease is explained by the model from Question 1?

```{r}
# Pseudo R^2 = 1 (residual deviance / null deviance)

1 - (5497.6/5800.7)
```

**About 5.23 percent of the devience in the probability of patients with coronary heart disease is explained by the full fit model.**



## QUESTION 4

Can any of the predictor variables be removed from the full model based on Likelihood Ratio Tests?

```{r}
drop1(full_fit, test="LRT")
```

**Since sbd is the only variable with an insignificant p-value (0.08205 > 0.05), it is the only variable that can be removed from the model.**






## QUESTION 5

Could multicollinearity be influencing the results from Question 4?  Find the Variance Inflation Factors (VIFs) for all predictor variables in the full model fit.

```{r}
vif(full_fit)
```

**There is no evidence of problematic multicollinearity in this model, since all vif values are less that 5.**




## QUESTION 6

Fit a reduced model that has removed all conditionally insignificant variables from Question 4. Use this model to predict the probability of coronary heart disease for an individual aged 47, with a Systolic Blood Pressure of 118, a Diastolic Blood Pressure of 72, a Cholesterol level of 123 and BMI of 28.

```{r}
reduced_fit <- glm(chdfate ~ age + dbp + scl + bmi,
                     data=framingham,
                     family=binomial(link="logit"))


new_person <- data.frame(
  age = 47,
  sbp = 118,
  dbp = 72,
  scl = 123,
  bmi = 28
)

pred <- predict(reduced_fit, newdata = new_person, type = "response")

pred
```

**The probability of coronary heart disease for an individual aged 47, with a Systolic Blood Pressure of 118, a Diastolic Blood Pressure of 72, a Cholesterol level of 123, and BMI of 28, is 17.67 percent.**


